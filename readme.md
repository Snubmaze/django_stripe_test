# Django Stripe App

–ü—Ä–æ—Å—Ç–æ–µ Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ Stripe. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –≤ Docker (–î–æ—Å—Ç—É–ø–Ω–æ –æ–Ω–ª–∞–π–Ω)

## –î–æ—Å—Ç—É–ø

### üåê Online (–∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –æ–Ω–ª–∞–π–Ω –ø–æ –∞–¥—Ä–µ—Å—É:

- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: http://45.82.14.50:8000
- **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å**: http://45.82.14.50:8000/admin
- **–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∞**: 
  - Username: `admin`
  - Password: `admin`

### üè† –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –Ω–∞ [Stripe Dashboard](https://dashboard.stripe.com)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª [API keys](https://dashboard.stripe.com/apikeys)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Secret Key** –∏ **Publishable Key** –∏–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
4. –í—Å—Ç–∞–≤—å—Ç–µ –∏—Ö –≤ —Ñ–∞–π–ª `.env.example`:

```env
STRIPE_SECRET_KEY=sk_test...
STRIPE_PUBLISHABLE_KEY=pk_test...
```

### –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

```bash
chmod +x run.sh
./run.sh
```

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–æ–∑–¥–∞—Å—Ç `.env` –∏–∑ `.env.example` (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- –ü–æ–¥–Ω–∏–º–µ—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å PostgreSQL –∏ Django
- –ó–∞–ø—É—Å—Ç–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
- –°–æ–∑–¥–∞—Å—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:

- **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: http://localhost:8000
- **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å**: http://localhost:8000/admin
- **–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∞** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): 
  - Username: `admin`
  - Password: `admin`

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
stripe_app/
‚îú‚îÄ‚îÄ items/                          # Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ management/commands/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create_admin.py        # –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ initdata.py            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ templates/items/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ item.html              # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ order.html             # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ—Ä–∑–∏–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ models.py                  # –ú–æ–¥–µ–ª–∏ (Item, Order, OrderItem, etc)
‚îÇ   ‚îú‚îÄ‚îÄ views.py                   # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ utils.py                   # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ Stripe
‚îú‚îÄ‚îÄ stripe_app/
‚îÇ   ‚îú‚îÄ‚îÄ settings.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Django
‚îÇ   ‚îú‚îÄ‚îÄ urls.py                    # URL –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ wsgi.py
‚îú‚îÄ‚îÄ docker-compose.yaml            # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile                      # Docker –æ–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ entrypoint.sh                  # –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ run.sh                         # Bash —Å–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ .env.example                   # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ requirements.txt               # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ú–æ–¥–µ–ª—å Item
–¢–æ–≤–∞—Ä—ã –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| id | Integer | Primary key |
| name | String(60) | –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ |
| description | Text | –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ |
| price | Integer | –¶–µ–Ω–∞ –≤ —Ü–µ–Ω—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä 1000 = $10.00) |

### –ú–æ–¥–µ–ª—å Order
–ó–∞–∫–∞–∑ (–∫–æ—Ä–∑–∏–Ω–∞)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| id | Integer | Primary key |
| created_at | DateTime | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| is_paid | Boolean | –û–ø–ª–∞—á–µ–Ω –ª–∏ –∑–∞–∫–∞–∑ |
| discount | ForeignKey | –°–∫–∏–¥–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| tax | ForeignKey | –ù–∞–ª–æ–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |

### –ú–æ–¥–µ–ª—å OrderItem
–¢–æ–≤–∞—Ä –≤ –∑–∞–∫–∞–∑–µ (—Å–≤—è–∑—å many-to-many –º–µ–∂–¥—É Order –∏ Item)

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| id | Integer | Primary key |
| order | ForeignKey | –°—Å—ã–ª–∫–∞ –Ω–∞ Order |
| item | ForeignKey | –°—Å—ã–ª–∫–∞ –Ω–∞ Item |
| quantity | Integer | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ |

### –ú–æ–¥–µ–ª—å Discount
–°–∫–∏–¥–∫–∞ –Ω–∞ –∑–∞–∫–∞–∑

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| id | Integer | Primary key |
| name | String(100) | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫–∏–¥–∫–∏ |
| discount_type | String(20) | –¢–∏–ø: percentage –∏–ª–∏ fixed |
| value | Integer | –†–∞–∑–º–µ—Ä —Å–∫–∏–¥–∫–∏ (% –∏–ª–∏ —Ü–µ–Ω—Ç—ã) |
| stripe_coupon_id | String(100) | ID –∫—É–ø–æ–Ω–∞ –≤ Stripe |
| is_active | Boolean | –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ —Å–∫–∏–¥–∫–∞ |
| created_at | DateTime | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

### –ú–æ–¥–µ–ª—å Tax
–ù–∞–ª–æ–≥ –Ω–∞ –∑–∞–∫–∞–∑

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| id | Integer | Primary key |
| name | String(100) | –ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–ª–æ–≥–∞ |
| percentage | Decimal(5,2) | –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–∞–ª–æ–≥–∞ |
| stripe_tax_rate_id | String(100) | ID –Ω–∞–ª–æ–≥–∞ –≤ Stripe |
| is_active | Boolean | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –Ω–∞–ª–æ–≥ |
| created_at | DateTime | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |

## API endpoints

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| GET | `/items/<id>/` | –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ —Å –∫–Ω–æ–ø–∫–æ–π –ø–æ–∫—É–ø–∫–∏ |
| POST | `/buy/<id>/` | –°–æ–∑–¥–∞—Ç—å Stripe Session –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ |
| POST | `/add-to-cart/<id>/` | –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É |
| GET | `/cart/` | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ—Ä–∑–∏–Ω—ã |
| POST | `/buy-order/<id>/` | –°–æ–∑–¥–∞—Ç—å Stripe Session –¥–ª—è –∑–∞–∫–∞–∑–∞ |
| POST | `/cart/change/<order_id>/<item_id>/` | –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ |
| POST | `/cart/delete/<order_id>/<item_id>/` | –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã |

## –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
docker-compose down
```

### –û—á–∏—Å—Ç–∫–∞ (–≤–∫–ª—é—á–∞—è –ë–î)

```bash
docker-compose down -v
```

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Django 4.x** - Python –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL 15** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Docker & Docker Compose** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **Stripe API** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- **Bootstrap-–ø–æ–¥–æ–±–Ω—ã–π CSS** - —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã Stripe:
- **–£—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç–µ–∂**: 4242 4242 4242 4242
- **–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–π –ø–ª–∞—Ç–µ–∂**: 4000 0000 0000 0002
- –î–∞—Ç–∞: –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä 12/25)
- CVC: –ª—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä 123)

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–∞—Ä—Ç: https://stripe.com/docs/testing

## –ò—Å—Ç–æ—á–Ω–∏–∫–∏ Stripe –∫–ª—é—á–µ–π

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–ª—é—á–µ–π:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://dashboard.stripe.com/apikeys
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∫–ª—é—á–µ–Ω **—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º** (—Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏:
   - **Publishable key** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `pk_test_`)
   - **Secret key** (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk_test_`)
4. –í—Å—Ç–∞–≤—å—Ç–µ –∏—Ö –≤ `.env.example`